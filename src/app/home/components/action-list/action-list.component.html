<div class="action-list" [class.collapsed]="collapsed && isAllComplete" [class.edit-mode]="editMode">
  <!-- Header -->
  <div class="action-list-header" (click)="onHeaderClick()">
    <div class="header-left">
      <h3>üìã Today's Actions</h3>
      <span class="action-count">{{ completedCount }}/{{ totalCount }}</span>
    </div>
    <div class="header-right">
      <button class="edit-order-btn" (click)="onEditClick($event)" [class.active]="editMode">
        {{ editMode ? '‚úì Done' : '‚áÖ' }}
      </button>
      <div class="progress-badge" [class.complete]="isAllComplete" *ngIf="!editMode">
        {{ isAllComplete ? '‚úì Done' : progressPercent + '%' }}
      </div>
      <span class="expand-icon" *ngIf="!editMode">{{ !collapsed || !isAllComplete ? '‚ñº' : '‚ñ∂' }}</span>
    </div>
  </div>

  <!-- Edit Mode Notice -->
  <div class="edit-notice" *ngIf="editMode">
    Drag and drop to reorder actions
  </div>

  <!-- Progress Bar -->
  <div class="progress-bar-container" *ngIf="(!collapsed || !isAllComplete) && !editMode">
    <div class="progress-bar" [style.width.%]="progressPercent"></div>
  </div>

  <!-- Pending Action Items -->
  <div class="action-items" *ngIf="!collapsed || !isAllComplete || editMode">
    <div class="loading" *ngIf="isLoading">Loading actions...</div>
    
    <!-- Edit Mode: Show all actions with drag and drop -->
    <ng-container *ngIf="editMode">
      <div 
        class="action-item edit-item" 
        *ngFor="let action of visibleActions; let i = index"
        [class.completed]="action.status === 'completed'"
        [class.dragging]="draggedIndex === i"
        draggable="true"
        (dragstart)="onDragStart(i, $event)"
        (dragover)="onDragOver($event)"
        (drop)="onDrop(i, $event)"
        (dragend)="onDragEnd()">
        
        <div class="drag-handle">
          <span class="drag-icon">‚ãÆ‚ãÆ</span>
        </div>
        
        <div class="action-icon">{{ action.icon }}</div>
        
        <div class="action-content">
          <span class="action-title">{{ action.title }}</span>
          <span class="action-desc">{{ action.description }}</span>
        </div>
      </div>
    </ng-container>
    
    <!-- Normal Mode: Pending actions -->
    <ng-container *ngIf="!editMode">
      <div 
        class="action-item" 
        *ngFor="let action of pendingActions"
        [class.in-progress]="action.status === 'in_progress'"
        (click)="onActionClick(action)">
        
        <div class="action-check">
          <span *ngIf="action.status === 'in_progress'" class="spinner">‚è≥</span>
        </div>
        
        <div class="action-icon">{{ action.icon }}</div>
        
        <div class="action-content">
          <span class="action-title">{{ action.title }}</span>
          <span class="action-desc">{{ action.description }}</span>
        </div>
        
        <div class="action-arrow">
          <span *ngIf="action.externalLink">‚Üó</span>
          <span *ngIf="!action.externalLink">‚Üí</span>
        </div>
      </div>

      <div class="no-actions" *ngIf="!isLoading && pendingActions.length === 0 && completedActions.length === 0">
        No actions for today
      </div>
    </ng-container>
  </div>

  <!-- Completed Section -->
  <div class="completed-section" *ngIf="!editMode && completedActions.length > 0 && (!collapsed || !isAllComplete)">
    <div class="completed-header" (click)="toggleCompletedSection()">
      <span class="completed-label">‚úì Completed ({{ completedActions.length }})</span>
      <span class="completed-toggle">{{ completedCollapsed ? '‚ñ∂' : '‚ñº' }}</span>
    </div>
    
    <div class="completed-items" *ngIf="!completedCollapsed">
      <div 
        class="action-item completed" 
        *ngFor="let action of completedActions"
        (click)="onActionClick(action)">
        
        <div class="action-check">
          <span>‚úì</span>
        </div>
        
        <div class="action-icon">{{ action.icon }}</div>
        
        <div class="action-content">
          <span class="action-title">{{ action.title }}</span>
          <span class="action-desc">{{ action.description }}</span>
        </div>
        
        <div class="action-arrow">
          <span class="undo-hint" title="Click to undo">‚Ü©</span>
        </div>
      </div>
    </div>
  </div>
</div>
